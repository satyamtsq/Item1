name: GitHub Actions Pipelinee
on:
  push:
    branches:
      - main

jobs:
  invoke_api:
    runs-on: windows-latest
    steps:
      - name: Install OpenVPN
        run: |
           choco install openvpn
           $openvpnPath = (Get-Package -Name openvpn -ProviderName Chocolatey).InstallLocation
           Write-Host "OpenVPN installed at: $openvpnPath"
      - name: Set up VPN connection
        run: |
              Start-Process -FilePath "C:\Program Files\OpenVPN Connect\OpenVPNConnect.exe" -ArgumentList @("--config", "F:\OpenVPN\pfSense-udp-1194-config.ovpn", "--daemon")
              Start-Sleep -s 10  # Wait for the VPN connection to establish
      - name: Call REST API
        run: |
          $BatchscheduleID = '${{ secrets.BATCHSCHEDULEID }}'
          $params = @{
            Uri = 'http://172.31.19.121:8080/test-automation-via-cicd'
            Method = 'POST'
            Body = @{
              Usernameofbreez = 'qa@chartrequest.com'
              Passwordofbreez = 'tsq@123'
              BatchscheduleID = $BatchscheduleID
              IpAddress = 'http://172.31.19.121:8080/'
            }
          }
